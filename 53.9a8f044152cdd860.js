"use strict";(self.webpackChunkstock_analysis=self.webpackChunkstock_analysis||[]).push([[53],{9053:(pt,I,c)=>{c.r(I),c.d(I,{StocksModule:()=>rt});var l=c(3075),Y=c(3430),f=c(9808),b=c(7826),U=c(1042),t=c(5e3),m=c(8966),S=c(7264),T=c(4087),A=c(1135),u=c(4437),N=c(4073);let y=(()=>{class i{constructor(e){this.ls=e,this.stocks$=new A.X([]),this.initLS(),this.emit()}set(e){this.ls.set(u.P.SECURITIES,e),this.emit()}add(e){const s=this.get();s.unshift(e),this.set(s)}update(e){const s=this.get(),o=s.findIndex(n=>n.id===e.id);s[o]=e,this.set(s)}getById(e){return this.stocks$.value.find(s=>s.id===e)}delete(e){const s=this.get(),o=s.findIndex(n=>n.id===e.id);o>-1&&s.splice(o,1),this.set(s)}calculateResult(e,s,o){let n=0;for(const r of o){let g=0,p=0,F=0;for(const Z of r.parameters){const D=Z.weight;p+=Z.max*D,F+=s[e][r.id][Z.id]*D}g=F/p*100*r.weight,n+=g}return n}get(){return this.ls.get(u.P.SECURITIES)}initLS(){this.ls.get(u.P.SECURITIES)||this.ls.set(u.P.SECURITIES,[])}emit(){this.stocks$.next(this.ls.get(u.P.SECURITIES))}}return i.\u0275fac=function(e){return new(e||i)(t.LFG(N.n))},i.\u0275prov=t.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var h=c(7322),_=c(7531),k=c(4107),v=c(508),C=c(7423);function E(i,a){if(1&i&&(t.TgZ(0,"mat-option",12),t._uU(1),t.qZA()),2&i){const e=a.$implicit;t.Q6J("value",e.id),t.xp6(1),t.hij(" ",e.name," ")}}function J(i,a){if(1&i){const e=t.EpF();t.TgZ(0,"div",15)(1,"mat-form-field",3)(2,"mat-label"),t._uU(3),t.qZA(),t.TgZ(4,"input",16),t.NdJ("ngModelChange",function(o){const r=t.CHM(e).$implicit,g=t.oxw().$implicit,p=t.oxw();return p.analysisInputs[p.selectedStrategy.id][g.id][r.id]=o}),t.qZA()()()}if(2&i){const e=a.$implicit,s=t.oxw().$implicit,o=t.oxw();t.xp6(3),t.Oqu(e.name),t.xp6(1),t.Q6J("ngModel",o.analysisInputs[o.selectedStrategy.id][s.id][e.id])("min",e.min)("max",e.max)}}function R(i,a){if(1&i&&(t.TgZ(0,"div",13),t._uU(1),t.YNc(2,J,5,4,"div",14),t.qZA()),2&i){const e=a.$implicit;t.xp6(1),t.hij(" ",e.name," "),t.xp6(1),t.Q6J("ngForOf",e.parameters)}}let $=(()=>{class i{constructor(e,s,o,n,r){this.fb=e,this.dialogRef=s,this.strategiesService=o,this.analysisService=n,this.stocksService=r,this.analysis=[],this.analysisInputs={}}ngOnInit(){console.log("st"),this.strategies=this.strategiesService.strategies$.value,this.stockForm=this.fb.group({name:["",[l.kI.required]],longName:["",[]],strategy:[null]}),this.stockForm.get("strategy").valueChanges.subscribe(e=>{this.selectedStrategy=this.strategies.find(s=>s.id==e),this.analysis=this.analysisService.analysis$.value.filter(s=>s.strategyId===this.selectedStrategy.id),this.fillAnalysisInputs(),console.log("selectedStrategy",this.selectedStrategy),console.log("analysis",this.analysis)})}fillAnalysisInputs(){this.analysisInputs[this.selectedStrategy.id]={};for(const e of this.analysis){this.analysisInputs[this.selectedStrategy.id][e.id]={};for(const s of e.parameters)this.analysisInputs[this.selectedStrategy.id][e.id][s.id]=null}}onSave(){const e=this.stocksService.calculateResult(this.selectedStrategy.id,this.analysisInputs,this.analysis),s={[this.selectedStrategy.id]:e},o={id:(0,U.Z)(),name:this.stockForm.get("name").value,longName:this.stockForm.get("longName").value,color:null,lastCalculatedResult:s,analysisInputs:this.analysisInputs};this.dialogRef.close(o)}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(l.qu),t.Y36(m.so),t.Y36(S.D),t.Y36(T.K),t.Y36(y))},i.\u0275cmp=t.Xpm({type:i,selectors:[["add-stock-dialog"]],decls:22,vars:4,consts:[["mat-dialog-title",""],["mat-dialog-content",""],[1,"stock-form",3,"formGroup"],["appearance","fill"],["matInput","","formControlName","name"],["matInput","","formControlName","longName"],["formControlName","strategy"],[3,"value",4,"ngFor","ngForOf"],[1,"analysis-container"],["class","analysis",4,"ngFor","ngForOf"],["mat-dialog-actions",""],["mat-button","","color","primary",3,"disabled","click"],[3,"value"],[1,"analysis"],["class","parameter",4,"ngFor","ngForOf"],[1,"parameter"],["type","number","matInput","",3,"ngModel","min","max","ngModelChange"]],template:function(e,s){1&e&&(t.TgZ(0,"h1",0),t._uU(1,"Add Stock"),t.qZA(),t.TgZ(2,"div",1)(3,"form",2)(4,"mat-form-field",3)(5,"mat-label"),t._uU(6,"Stock name"),t.qZA(),t._UZ(7,"input",4),t.qZA(),t.TgZ(8,"mat-form-field",3)(9,"mat-label"),t._uU(10,"Stock Long name"),t.qZA(),t._UZ(11,"input",5),t.qZA(),t.TgZ(12,"mat-form-field",3)(13,"mat-label"),t._uU(14,"Strategy"),t.qZA(),t.TgZ(15,"mat-select",6),t.YNc(16,E,2,2,"mat-option",7),t.qZA()()(),t.TgZ(17,"div",8),t.YNc(18,R,3,2,"div",9),t.qZA()(),t.TgZ(19,"div",10)(20,"button",11),t.NdJ("click",function(){return s.onSave()}),t._uU(21,"Save"),t.qZA()()),2&e&&(t.xp6(3),t.Q6J("formGroup",s.stockForm),t.xp6(13),t.Q6J("ngForOf",s.strategies),t.xp6(2),t.Q6J("ngForOf",s.analysis),t.xp6(2),t.Q6J("disabled",s.stockForm.invalid))},directives:[m.uh,m.xY,l._Y,l.JL,l.sg,h.KE,h.hX,_.Nt,l.Fj,l.JJ,l.u,k.gD,f.sg,v.ey,l.wV,l.qQ,l.Fd,l.On,m.H8,C.lW],styles:[".stock-form[_ngcontent-%COMP%]{display:flex;flex-direction:column}"]}),i})();var d=c(4999),Q=c(449),x=c(4847);function O(i,a){if(1&i&&(t.TgZ(0,"mat-option",12),t._uU(1),t.qZA()),2&i){const e=a.$implicit;t.Q6J("value",e.id),t.xp6(1),t.hij(" ",e.name," ")}}function M(i,a){if(1&i){const e=t.EpF();t.TgZ(0,"div",15)(1,"mat-form-field",3)(2,"mat-label"),t._uU(3),t.qZA(),t.TgZ(4,"input",16),t.NdJ("ngModelChange",function(o){const r=t.CHM(e).$implicit,g=t.oxw().$implicit,p=t.oxw();return p.analysisInputs[p.selectedStrategy.id][g.id][r.id]=o}),t.qZA()()()}if(2&i){const e=a.$implicit,s=t.oxw().$implicit,o=t.oxw();t.xp6(3),t.Oqu(e.name),t.xp6(1),t.Q6J("ngModel",o.analysisInputs[o.selectedStrategy.id][s.id][e.id])("min",e.min)("max",e.max)}}function q(i,a){if(1&i&&(t.TgZ(0,"div",13),t._uU(1),t.YNc(2,M,5,4,"div",14),t.qZA()),2&i){const e=a.$implicit;t.xp6(1),t.hij(" ",e.name," "),t.xp6(1),t.Q6J("ngForOf",e.parameters)}}let w=(()=>{class i{constructor(e,s,o,n,r,g){this.fb=e,this.dialogRef=s,this.data=o,this.strategiesService=n,this.analysisService=r,this.stocksService=g,this.analysis=[],this.analysisInputs={}}ngOnInit(){console.log("st"),this.strategies=this.strategiesService.strategies$.value,this.stockForm=this.fb.group({name:[this.data.stock.name,[l.kI.required]],longName:[this.data.stock.longName,[]],strategy:[this.data.strategyId]}),this.determineStrategy(this.data.strategyId),this.stockForm.get("strategy").valueChanges.subscribe(e=>{this.determineStrategy(e)})}fillAnalysisInputs(){console.log("fillAnalysisInputs");const e=this.data.stock.analysisInputs;for(const s of this.analysis)if(e[this.selectedStrategy.id]&&(this.analysisInputs[this.selectedStrategy.id]={},e[this.selectedStrategy.id][s.id])){this.analysisInputs[this.selectedStrategy.id][s.id]={};for(const o of s.parameters)e[this.selectedStrategy.id][s.id][o.id]&&(this.analysisInputs[this.selectedStrategy.id][s.id][o.id]=e[this.selectedStrategy.id][s.id][o.id])}console.log("this.analysisInputs",this.analysisInputs)}determineStrategy(e){this.selectedStrategy=this.strategies.find(s=>s.id==e),this.analysis=this.analysisService.analysis$.value.filter(s=>s.strategyId===this.selectedStrategy.id),this.fillAnalysisInputs()}onSave(){const e=this.stocksService.calculateResult(this.selectedStrategy.id,this.analysisInputs,this.analysis);this.data.stock.lastCalculatedResult[this.selectedStrategy.id]?this.data.stock.lastCalculatedResult[this.selectedStrategy.id]=e:this.data.stock.lastCalculatedResult={[this.selectedStrategy.id]:e};const s={id:this.data.stock.id,name:this.stockForm.get("name").value,longName:this.stockForm.get("longName").value,color:this.data.stock.color,lastCalculatedResult:this.data.stock.lastCalculatedResult,analysisInputs:this.analysisInputs};console.log("updated stock",s),this.dialogRef.close(s)}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(l.qu),t.Y36(m.so),t.Y36(m.WI),t.Y36(S.D),t.Y36(T.K),t.Y36(y))},i.\u0275cmp=t.Xpm({type:i,selectors:[["edit-stock-dialog"]],decls:22,vars:4,consts:[["mat-dialog-title",""],["mat-dialog-content",""],[1,"stock-form",3,"formGroup"],["appearance","fill"],["matInput","","formControlName","name"],["matInput","","formControlName","longName"],["formControlName","strategy"],[3,"value",4,"ngFor","ngForOf"],[1,"analysis-container"],["class","analysis",4,"ngFor","ngForOf"],["mat-dialog-actions",""],["mat-button","","color","primary",3,"disabled","click"],[3,"value"],[1,"analysis"],["class","parameter",4,"ngFor","ngForOf"],[1,"parameter"],["type","number","matInput","",3,"ngModel","min","max","ngModelChange"]],template:function(e,s){1&e&&(t.TgZ(0,"h1",0),t._uU(1,"Edit Stock"),t.qZA(),t.TgZ(2,"div",1)(3,"form",2)(4,"mat-form-field",3)(5,"mat-label"),t._uU(6,"Stock name"),t.qZA(),t._UZ(7,"input",4),t.qZA(),t.TgZ(8,"mat-form-field",3)(9,"mat-label"),t._uU(10,"Stock Long name"),t.qZA(),t._UZ(11,"input",5),t.qZA(),t.TgZ(12,"mat-form-field",3)(13,"mat-label"),t._uU(14,"Strategy"),t.qZA(),t.TgZ(15,"mat-select",6),t.YNc(16,O,2,2,"mat-option",7),t.qZA()()(),t.TgZ(17,"div",8),t.YNc(18,q,3,2,"div",9),t.qZA()(),t.TgZ(19,"div",10)(20,"button",11),t.NdJ("click",function(){return s.onSave()}),t._uU(21,"Save"),t.qZA()()),2&e&&(t.xp6(3),t.Q6J("formGroup",s.stockForm),t.xp6(13),t.Q6J("ngForOf",s.strategies),t.xp6(2),t.Q6J("ngForOf",s.analysis),t.xp6(2),t.Q6J("disabled",s.stockForm.invalid))},directives:[m.uh,m.xY,l._Y,l.JL,l.sg,h.KE,h.hX,_.Nt,l.Fj,l.JJ,l.u,k.gD,f.sg,v.ey,l.wV,l.qQ,l.Fd,l.On,m.H8,C.lW],styles:[".stock-form[_ngcontent-%COMP%]{display:flex;flex-direction:column}"]}),i})(),L=(()=>{class i{constructor(e){this.ls=e,this.included$=new A.X([]),this.initLS(),this.emit()}set(e){this.ls.set(u.P.INCLUDED_IN_ANALYSIS,e),this.emit()}add(e){const s=this.get();s.unshift(e),this.set(s)}update(e){const s=this.get(),o=s.findIndex(n=>n===e);s[o]=e,this.set(s)}delete(e){const s=this.get(),o=s.findIndex(n=>n===e);o>-1&&s.splice(o,1),this.set(s)}get(){return this.ls.get(u.P.INCLUDED_IN_ANALYSIS)}initLS(){this.ls.get(u.P.INCLUDED_IN_ANALYSIS)||this.ls.set(u.P.INCLUDED_IN_ANALYSIS,[])}emit(){this.included$.next(this.ls.get(u.P.INCLUDED_IN_ANALYSIS))}}return i.\u0275fac=function(e){return new(e||i)(t.LFG(N.n))},i.\u0275prov=t.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var P=c(7446),H=c(8099);function j(i,a){if(1&i&&(t.TgZ(0,"mat-option",21),t._uU(1),t.qZA()),2&i){const e=a.$implicit;t.Q6J("value",e.id),t.xp6(1),t.hij(" ",e.name," ")}}function B(i,a){1&i&&t._UZ(0,"th",22)}function G(i,a){if(1&i){const e=t.EpF();t.TgZ(0,"td",23)(1,"mat-checkbox",24),t.NdJ("click",function(o){return o.stopPropagation()})("change",function(o){const r=t.CHM(e).$implicit;return t.oxw().toggleInclude(o,r)}),t.qZA()()}if(2&i){const e=a.$implicit,s=t.oxw();t.xp6(1),t.Q6J("checked",s.selection.isSelected(e.id))("aria-label",s.checkboxLabel(e))}}function X(i,a){1&i&&(t.TgZ(0,"th",22),t._uU(1," Name "),t.qZA())}function V(i,a){if(1&i&&(t.TgZ(0,"td",23),t._uU(1),t.qZA()),2&i){const e=a.$implicit;t.xp6(1),t.hij(" ",e.name," ")}}function z(i,a){1&i&&(t.TgZ(0,"th",22),t._uU(1," Full Name "),t.qZA())}function K(i,a){if(1&i&&(t.TgZ(0,"td",23),t._uU(1),t.qZA()),2&i){const e=a.$implicit;t.xp6(1),t.hij(" ",e.longName," ")}}function W(i,a){1&i&&(t.TgZ(0,"th",25),t._uU(1," points "),t.qZA())}function tt(i,a){if(1&i&&(t.TgZ(0,"td",23),t._uU(1),t.qZA()),2&i){const e=a.$implicit,s=t.oxw();t.xp6(1),t.hij(" ",e.lastCalculatedResult[s.selectedStrategyId]," ")}}function et(i,a){1&i&&t._UZ(0,"th",26)}function st(i,a){if(1&i){const e=t.EpF();t.TgZ(0,"td",23)(1,"button",27),t.NdJ("click",function(){const n=t.CHM(e).$implicit;return t.oxw().editStock(n)}),t.TgZ(2,"mat-icon"),t._uU(3,"edit"),t.qZA()()()}}function it(i,a){1&i&&t._UZ(0,"th",26)}function ot(i,a){if(1&i){const e=t.EpF();t.TgZ(0,"td",23)(1,"button",28),t.NdJ("click",function(){const n=t.CHM(e).$implicit;return t.oxw().deleteStock(n)}),t.TgZ(2,"mat-icon"),t._uU(3,"delete"),t.qZA()()()}}function at(i,a){1&i&&t._UZ(0,"tr",29)}function nt(i,a){if(1&i){const e=t.EpF();t.TgZ(0,"tr",30),t.NdJ("click",function(){const n=t.CHM(e).$implicit;return t.oxw().selection.toggle(n)}),t.qZA()}}let lt=(()=>{class i{constructor(e,s,o,n){this.dialog=e,this.stocksService=s,this.includedService=o,this.strategiesService=n,this.stocks=[],this.selection=new Q.Ov(!0,[]),this.displayedColumns=["select","name","longName","lastCalculatedResult","edit","delete"]}ngAfterViewInit(){console.log("this.sort",this.sort),this.dataSource.sort=this.sort}ngOnInit(){this.selectedStrategyId=this.strategiesService.getDefaultStrategyId(),this.strategies=this.strategiesService.strategies$.value,this.stocksService.stocks$.subscribe(e=>{this.stocks=e,this.dataSource=new d.by(this.stocks)}),this.includedService.included$.value.forEach(e=>{this.selection.select(e)})}addStock(){this.dialog.open($).afterClosed().subscribe(s=>{s&&this.stocksService.add(s)})}applyFilter(e){this.dataSource.filter=e.target.value.trim().toLowerCase(),this.dataSource.paginator&&this.dataSource.paginator.firstPage()}isAllSelected(){return this.selection.selected.length===this.dataSource.data.length}checkboxLabel(e){return e?this.selection.isSelected(e.id)?"deselect":"select":(this.isAllSelected()?"deselect":"select")+" all"}deleteStock(e){this.dialog.open(b.$,{data:{title:"Delete Stock",message:`Are you sure you want to delete stock ${e.name} = ${e.longName}`}}).afterClosed().subscribe(o=>{o&&this.stocksService.delete(e)})}editStock(e){this.dialog.open(w,{data:{stock:e,strategyId:"6e558027-f665-490b-861b-0acf0b96a3b0"}}).afterClosed().subscribe(o=>{o&&this.stocksService.delete(e)})}toggleInclude(e,s){e.checked?this.includedService.add(s.id):this.includedService.delete(s.id)}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(m.uw),t.Y36(y),t.Y36(L),t.Y36(S.D))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-stocks"]],viewQuery:function(e,s){if(1&e&&t.Gf(x.YE,5),2&e){let o;t.iGM(o=t.CRH())&&(s.sort=o.first)}},decls:34,vars:5,consts:[[1,"actions"],["mat-button","","color","primary",3,"click"],["appearance","standard"],["matInput","","placeholder","Ex. Mia",3,"keyup"],["input",""],["appearance","fill"],[3,"value","valueChange"],[3,"value",4,"ngFor","ngForOf"],["mat-table","","matSort","",1,"mat-elevation-z8",3,"dataSource"],["matColumnDef","select"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","name"],["matColumnDef","longName"],["matColumnDef","lastCalculatedResult"],["mat-header-cell","","mat-sort-header","","mat-sort-header","",4,"matHeaderCellDef"],["matColumnDef","edit"],["mat-header-cell","",4,"matHeaderCellDef"],["matColumnDef","delete"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",3,"click",4,"matRowDef","matRowDefColumns"],[3,"value"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],[3,"checked","aria-label","click","change"],["mat-header-cell","","mat-sort-header","","mat-sort-header",""],["mat-header-cell",""],["mat-icon-button","","color","accent","aria-label","Edit",3,"click"],["mat-icon-button","","color","warn","aria-label","Delete",3,"click"],["mat-header-row",""],["mat-row","",3,"click"]],template:function(e,s){1&e&&(t.TgZ(0,"div",0)(1,"button",1),t.NdJ("click",function(){return s.addStock()}),t._uU(2,"Add Stock"),t.qZA(),t.TgZ(3,"mat-form-field",2)(4,"mat-label"),t._uU(5,"Filter"),t.qZA(),t.TgZ(6,"input",3,4),t.NdJ("keyup",function(n){return s.applyFilter(n)}),t.qZA()(),t.TgZ(8,"mat-form-field",5)(9,"mat-label"),t._uU(10,"Strategy"),t.qZA(),t.TgZ(11,"mat-select",6),t.NdJ("valueChange",function(n){return s.selectedStrategyId=n}),t.YNc(12,j,2,2,"mat-option",7),t.qZA()()(),t.TgZ(13,"table",8),t.ynx(14,9),t.YNc(15,B,1,0,"th",10),t.YNc(16,G,2,2,"td",11),t.BQk(),t.ynx(17,12),t.YNc(18,X,2,0,"th",10),t.YNc(19,V,2,1,"td",11),t.BQk(),t.ynx(20,13),t.YNc(21,z,2,0,"th",10),t.YNc(22,K,2,1,"td",11),t.BQk(),t.ynx(23,14),t.YNc(24,W,2,0,"th",15),t.YNc(25,tt,2,1,"td",11),t.BQk(),t.ynx(26,16),t.YNc(27,et,1,0,"th",17),t.YNc(28,st,4,0,"td",11),t.BQk(),t.ynx(29,18),t.YNc(30,it,1,0,"th",17),t.YNc(31,ot,4,0,"td",11),t.BQk(),t.YNc(32,at,1,0,"tr",19),t.YNc(33,nt,1,0,"tr",20),t.qZA()),2&e&&(t.xp6(11),t.Q6J("value",s.selectedStrategyId),t.xp6(1),t.Q6J("ngForOf",s.strategies),t.xp6(1),t.Q6J("dataSource",s.dataSource),t.xp6(19),t.Q6J("matHeaderRowDef",s.displayedColumns),t.xp6(1),t.Q6J("matRowDefColumns",s.displayedColumns))},directives:[C.lW,h.KE,h.hX,_.Nt,k.gD,f.sg,v.ey,d.BZ,x.YE,d.w1,d.fO,d.ge,x.nU,d.Dz,d.ev,P.oG,H.Hw,d.as,d.XQ,d.nj,d.Gk],styles:["table[_ngcontent-%COMP%]{width:100%}.actions[_ngcontent-%COMP%]{margin-top:20px;display:flex}.actions[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{margin-right:10px}"]}),i})();var ct=c(1083);let rt=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[[f.ez,Y.R,ct.Bz.forChild([{path:"",component:lt}]),l.UX,l.u5]]}),i})()}}]);